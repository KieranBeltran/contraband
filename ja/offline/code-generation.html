<!DOCTYPE html SYSTEM "about:legacy-compat">
<html manifest="pamflet.manifest">
      <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>
        <title>Contraband — コード生成</title>
        
        <link rel="stylesheet" href="../css/blueprint/screen.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/blueprint/grid.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <link rel="stylesheet" href="../css/blueprint/print.css" type="text/css" media="print"/> 
        <!--[if lt IE 8]>
          <link rel="stylesheet" href={ relativeBase + "css/blueprint/ie.css" } type="text/css" media="screen, projection"/>
        <![endif]-->
        <link rel="stylesheet" href="../css/pamflet.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/pamflet-print.css" type="text/css" media="print"/>
        <link rel="stylesheet" href="../css/pamflet-grid.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <link rel="stylesheet" href="../css/color_scheme-redmond.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/color_scheme-github.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/color_scheme-monokai.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/pamfletheight_2em_2em.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <script type="text/javascript" src="../js/jquery-1.6.2.min.js"></script>
        <script type="text/javascript" src="../js/jquery.collapse.js"></script>
        <script type="text/javascript" src="../js/pamflet.js"></script>
        <script type="text/javascript">
          Pamflet.page.language = 'ja';
        </script>
        <script type="text/javascript" src="../js/prettify/prettify.js"></script><script type="text/javascript" src="../js/prettify/lang-scala.js"></script><link type="text/css" rel="stylesheet" href="../css/prettify.css"/><script type="text/javascript"><!--
        window.onload=function() { prettyPrint(); };
      --></script>
        <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, projection"/>
        
        
      </head>
      <body class="color_scheme-github">
        <a class="page prev nav" href="schema.html">
            <span class="space">&nbsp;</span>
            <span class="flip arrow">❧</span>
          </a><a class="page next nav" href="json.html">
            <span class="space">&nbsp;</span>
            <span class="arrow">❧</span>
          </a>
        <div class="container contentswrapper">
          <div class="span-16 prepend-1 append-1 contents">
            <h2 id="%E3%82%B3%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90">コード生成<a href="#%E3%82%B3%E3%83%BC%E3%83%89%E7%94%9F%E6%88%90" class="header-link"><span class="header-link-content">&nbsp;</span></a></h2><p>このページでは、Contraband の型システムが Java と Scala でどうエンコーディングされるのかを解説する。
</p><h3 id="%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89%E5%9E%8B">レコード型<a href="#%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89%E5%9E%8B" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>レコード型は Java や Scala ではクラスとして変換され、Scala に標準の case class に相当する。
</p><p>標準の case class は最初に使い始めるのは便利だが、バイナリ互換性を保ったままフィールドを追加することができない。
Contraband のレコード (疑似 case class と言うこともできる) は、case class とほぼ同様の機能を提供しつつバイナリ互換性を保ったままフィールドの追加を可能としている。
</p><pre><code class="">package com.example
@target(Scala)

type Person {
  name: String!
  age: Int
}
</code></pre><p>このスキーマは以下の Scala コードを生成する:
</p><pre><code class="prettyprint lang-scala">/**
 * This code is generated using sbt-datatype.
 */

// DO NOT EDIT MANUALLY
package com.example
final class Person private (
  val name: String,
  val age: Option[Int]) extends Serializable {
  override def equals(o: Any): Boolean = o match {
    case x: Person =&gt; (this.name == x.name) &amp;&amp; (this.age == x.age)
    case _ =&gt; false
  }
  override def hashCode: Int = {
    37 * (37 * (17 + name.##) + age.##)
  }
  override def toString: String = {
    &quot;Person(&quot; + name + &quot;, &quot; + age + &quot;)&quot;
  }
  protected[this] def copy(name: String = name, age: Option[Int] = age): Person = {
    new Person(name, age)
  }
  def withName(name: String): Person = {
    copy(name = name)
  }
  def withAge(age: Option[Int]): Person = {
    copy(age = age)
  }
  def withAge(age: Int): Person = {
    copy(age = Option(age))
  }
}
object Person {
  def apply(name: String, age: Option[Int]): Person = new Person(name, age)
  def apply(name: String, age: Int): Person = new Person(name, Option(age))
}
</code></pre><p>標準の case class と違って、Contraband のレコードは、
互換性を保ったまま進化できるように <code>unapply</code> や public な <code>copy</code> メソッドは実装しない。
</p><p><code>copy</code> の代わりにそれぞれのフィールドに対して <code>withX(...)</code> メソッドが生成される。
</p><pre><code class="prettyprint lang-scala">&gt; val x = Person(&quot;Alice&quot;, 20)
&gt; x.withAge(21)
</code></pre><p>Java のコード生成は以下のようになっている (target アノテーションを Java に変更する):
</p><pre><code class="prettyprint lang-java">/**
 * This code is generated using sbt-datatype.
 */

// DO NOT EDIT MANUALLY
package com.example;
public final class Person implements java.io.Serializable {

    private String name;
    private com.example.Maybe&lt;Integer&gt; age;
    public Person(String _name, com.example.Maybe&lt;Integer&gt; _age) {
        super();
        name = _name;
        age = _age;
    }
    public Person(String _name, int _age) {
        super();
        name = _name;
        age = com.example.Maybe.&lt;Integer&gt;just(_age);
    }
    public String name() {
        return this.name;
    }
    public com.example.Maybe&lt;Integer&gt; age() {
        return this.age;
    }
    public Person withName(String name) {
        return new Person(name, age);
    }
    public Person withAge(com.example.Maybe&lt;Integer&gt; age) {
        return new Person(name, age);
    }
    public Person withAge(int age) {
        return new Person(name, com.example.Maybe.&lt;Integer&gt;just(age));
    }
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        } else if (!(obj instanceof Person)) {
            return false;
        } else {
            Person o = (Person)obj;
            return name().equals(o.name()) &amp;&amp; age().equals(o.age());
        }
    }
    public int hashCode() {
        return 37 * (37 * (17 + name().hashCode()) + age().hashCode());
    }
    public String toString() {
        return &quot;Person(&quot;  + &quot;name: &quot; + name() + &quot;, &quot; + &quot;age: &quot; + age() + &quot;)&quot;;
    }
}
</code></pre><div class="bottom nav span-16">
                        <em>Next Page</em>
                        <span class="arrow">❧</span>
                        <a href="json.html"> JSON コーデックの生成 </a>                        
                        <ul class="language-bar">
        <li><a href="../code-generation.html"><span class="lang-item lang-en">English</span></a></li><li><a href="../ja/code-generation.html"><span class="lang-item lang-ja">日本語</span></a></li>
      </ul>
                      </div><div class="tocwrapper show">
      <a class="tochead nav" style="display: none" href="#toc">❦</a>
      <a name="toc"></a>
      <h4 class="toctitle">Contents</h4>
      <div class="tocbody">
      <div><a href="index.html">Contraband</a></div><ol class="toc"> <li><div><a href="schema.html">スキーマと型</a></div></li><li><div class="current">コード生成</div></li><li><div><a href="json.html">JSON コーデックの生成</a></div></li><li class="generated"><div><a href="Contents+in+Depth.html">Contents in Depth</a></div></li><li class="generated"><div><a href="Combined+Pages.html">Combined Pages</a></div></li> </ol></div></div>
          </div>
        </div>
        <div class="header">
          <div class="container">
        <div class="span-16 prepend-1 append-1">
          <div class="span-16 top nav">
            <div class="span-16 title">
              <span>Contraband</span> — コード生成
            </div>
          </div>
        </div>
      </div>
        </div>
        <div class="footer">
          
        </div>
        
        
      </body>
    </html>